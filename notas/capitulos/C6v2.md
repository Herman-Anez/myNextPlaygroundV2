Like many people looking to start learning about Next.js, I did the official tutorial on the Next.js website. It was very well written, with quizzes and just enough code left out to challenge you and help you retain the relevant concepts, yet also providing almost all of the boilerplate code to save you time.
Press enter or click to view image in full size
Photo by Gabriel Heinzer on Unsplash

Step 6, “Setting Up Your Database”, requires you to set up a Vercel account to create a project and database on their cloud service. While this is a very quick and easy solution for the tutorial, it’s not the best option for the long term. Unless you want to pay for a Pro account, you will have to delete the tutorial project and DB if you ever want to host a new project, as the hobby tier only allows you to have one project and one DB at a time.

Based on my experience setting up a local DB for my tutorial project so I have something to refer to while I work on another Next.js project, here are the instructions for doing the Next.js tutorial fully on a local database.
Prerequisites

    PostgreSQL installed locally — I use Postgres.app
    A way to create the initial DB and verify that the DB was seeded correctly. You can use an app such as Postico or do it via the command line — check the documentation of your preferred app for instructions.

If you already have these or similar apps installed, you are ready to begin!
Steps

    Create the DB locally using your preferred app. Name it next-js-dashboard. Setting a password is optional.
    The tutorial mentions copying the .env.local secrets that were generated when you created a database on the Vercel platform. Since you’re doing this locally, your secrets will be slightly different:

POSTGRES_URL="postgres://<your Postgres username>:<your DB password>@127.0.0.1:5432/next-js-dashboard"
POSTGRES_URL_NON_POOLING="postgres://<your Postgres username>:<your DB password>@127.0.0.1:5432/next-js-dashboard"
POSTGRES_USER="<your Postgres username>"
POSTGRES_HOST="127.0.0.1"
POSTGRES_PASSWORD="<your DB password, leave as an empty double quoted string if none>"
POSTGRES_DATABASE="next-js-dashboard"

If you did not use a DB password, then your URLs will be like this: "postgres://<your Postgres username>:@127.0.0.1:5432/next-js-dashboard"

The double quotes MUST be present. As per the official directions, copy and paste the secrets above, with your credentials, to your .env.example file, and be sure to rename the file to .env.

3. Instead of db and sql from the @vercel/postgres package, as shown in the tutorial, we will use Pool from pg.

    We will need to install pg and dotenv — npm install pg dotenv. If you’re not using NPM, install the packages using your preferred package manager’s directions.

4. Create a file called db.ts in the root directory. Add the following code:

You will use connectionPool to do all your SQL queries, as opposed to db and sql, when indicated in the tutorial. This means you will have to slightly tweak the boilerplate code provided to you, and will not need to install the Vercel Postgres SDK. Major thanks to this article by Pushpendra Shukla from SaffronTech for help with this step!

5. Seed the database. As of this writing, the seed file is located in app/seed/route.ts. The tutorial will indicate where the seed file is when you reach that step, and exact instructions/commands for seeding.

5.1. Replace const { db } = require('@vercel/postgres'); with const connectionPool = require('../../db'); in order to use the connectionPool module we just created. Make sure the path is correct for your project.

5.2. Remove or comment out const client = await db.connect();. Pool always keeps an open connection and does not require to be opened/closed every time you use it, unlike calls to client.
Get Deka Ambia’s stories in your inbox

Join Medium for free to get updates from this writer.

5.3. Inside of the seedUsers() function, replace every call to sql with connectionPool.query, for example:

    await client.sql`CREATE EXTENSION IF NOT EXISTS "uuid-ossp"`; will be changed to
    await connectionPool.query(`CREATE EXTENSION IF NOT EXISTS "uuid-ossp"`);. Do this with every call to sql, and PLEASE BE VERY, VERY SURE TO PUT SINGLE QUOTES AROUND EACH INTERPOLATION. Otherwise, you will get an error.

Example: insertedUsers inside of seedUsers() before the changes:

  const insertedUsers = await Promise.all(
    users.map(async (user) => {
      const hashedPassword = await bcrypt.hash(user.password, 10);
      return client.sql`
        INSERT INTO users (id, name, email, password)
        VALUES (${user.id}, ${user.name}, ${user.email}, ${hashedPassword})
        ON CONFLICT (id) DO NOTHING;
      `;
    }),
  );

and after the changes:

  const insertedUsers = await Promise.all(
    users.map(async (user) => {
      const hashedPassword = await bcrypt.hash(user.password, 10);
      return connectionPool.query(`
        INSERT INTO users (id, name, email, password)
        VALUES ('${user.id}', '${user.name}', '${user.email}', '${hashedPassword}')
        ON CONFLICT (id) DO NOTHING;
      `);
    }),
  );

Inside of the GET() function: As per the official instructions, remove or comment out the JSON response in the boilerplate. If present, make sure to also remove or comment out the lines with await client.sql`BEGIN`, await client.sql`COMMIT`, and await client.sql`ROLLBACK`.

If everything went well, and you are using the newest version of the tutorial, you will get a JSON message saying “Database seeded successfully”. You can also check your DB in your preferred app to see the seeded data.

6. Edit the boilerplate sql queries to use connectionPool.query.

6.1. Change every import { sql } from '@vercel/postgres'; reference to const connectionPool = require('./db');, making sure the path is correct. You will get type errors that you can ignore for now and will not affect functionality. These references will be in in auth.ts, actions.ts, and data.ts; if you are not at that part of the tutorial yet, you can wait until you get to them.

6.2. Replace every call to sql with connectionPool.query, for example:

try {
    await sql`
      INSERT INTO invoices (customer_id, amount, status, date)
      VALUES (${customerId}, ${amountInCents}, ${status}, ${date})
    `;
  } catch (error) {
    return {
      message: 'Database Error: Failed to Create Invoice.',
    };
  }

will be changed to:

try {
    await connectionPool.query(`
      INSERT INTO invoices (customer_id, amount, status, date)
      VALUES ('${customerId}', '${amountInCents}', '${status}', '${date}')
    `);
  } catch (error) {
    return {
      message: 'Database Error: Failed to Create Invoice.',
    };
  }

Just like when seeding, PLEASE BE VERY, VERY SURE TO PUT SINGLE QUOTES AROUND EACH INTERPOLATION. Otherwise, you will get an error.

When dealing with the nested interpolations, such as inside of fetchFilteredInvoices(), remove the outer interpolation and backticks and replace with single quotes, like this:

Original:

customers.name ILIKE ${`%${query}%`} OR
customers.email ILIKE ${`%${query}%`} OR
invoices.amount::text ILIKE ${`%${query}%`} OR
invoices.date::text ILIKE ${`%${query}%`} OR
invoices.status ILIKE ${`%${query}%`}

New:

customers.name ILIKE '%${query}%' OR
customers.email ILIKE '%${query}%' OR
invoices.amount::text ILIKE '%${query}%' OR
invoices.date::text ILIKE '%${query}%' OR
invoices.status ILIKE '%${query}%'

The tutorial is now available to be used entirely locally, and you can use this as a base for creating new projects that can be connected to the Postgres DB of your choice, whether that is locally or using a different service.

Please note that the tutorial can go through significant changes (it did between the few months that passed from the first time I did it to the time I wrote this), and you may have to tweak the instructions slightly. If you find any large discrepancies, or have any suggestions, please comment or send me a message. Happy coding!